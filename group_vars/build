---
rhel7cis_httpd: true

rhel7cis_notauto: false
rhel7cis_section1: true
rhel7cis_section2: true
rhel7cis_section3: true
rhel7cis_section4: true
rhel7cis_section5: true
rhel7cis_section6: true
rhel7cis_section7: true
rhel7cis_section8: true
rhel7cis_section9: true

http_port: 80
https_port: 443
slaveAgentPort: 8079

vault_postgres_user: dba
vault_postgres_pass: dba_pass
base_postgres_net: samenet

input_artifactory_password: password
artifactory_version: "4.9.0"
artifactory_database: postgres

# packages for systems management
yum_packages:
   - libselinux-python
   - libsemanage-python
   - python-httplib2
   - unzip
   - ansible # so you can use it as a control host too
   - acpid

jenkins_data: "/opt/jenkins"


nginx_official_repo: false
nginx_logs_dir: /var/log/nginx
nginx_certs_dir: /etc/pki/tls/certs
nginx_keys_dir: /etc/pki/tls/private
pki_cert_name: 'build_master.test'
pki_ca: internal_ca
nginx_key: "{{ nginx_keys_dir }}/server.key"
nginx_cer: "{{ nginx_certs_dir }}/server.cer"

nginx_http_params:
  - access_log "{{ nginx_logs_dir }}/access.log"
  - error_log "{{ nginx_logs_dir }}/error.log"
  - autoindex off
  - server_tokens off
  # - error_page 404 "/404.html"
  - add_header X-Frame-Options SAMEORIGIN
  - add_header X-Content-Type-Options nosniff

nginx_configs:
  ssl:
    - ssl_verify_depth 3
    - ssl_buffer_size 1400

    - ssl_protocols TLSv1.2
    - ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256
    - ssl_prefer_server_ciphers on

    - ssl_session_cache shared:SSL:10m
    - ssl_session_timeout 10m

    # NOTE: HSTS header should be sent "always" so as to also be available for non-2xx responses
    # NOTE: This, however, only works on nginx 1.7.5+; see http://dcmnt.me/1hl2HZq for more information
    # - add_header Strict-Transport-Security max-age=3600 always
    - add_header X-Frame-Options DENY
    - add_header X-Content-Type-Options nosniff
    - proxy_cache_path /var/tmp/nginx levels=1:2 keys_zone=nginx_cache:10m max_size=10g inactive=60m use_temp_path=off

nginx_sites:
  default:
    - listen 80
    - server_name _
    - return 301 https://{{ inventory_hostname }}$request_uri

  server:
    - listen 443 ssl
    - server_name "{{ inventory_hostname }}"
    - location /jenkins { proxy_pass http://127.0.0.1:{{ jenkins_port }}/jenkins; }
    - location /artifactory { proxy_pass http://127.0.0.1:{{ artifactory_port }}/artifactory; }
    - ssl on
    - ssl_certificate_key "{{ nginx_key }}"
    - ssl_certificate "{{ nginx_cer }}"
    - proxy_set_header Host $host
    - proxy_set_header X-Real-IP $remote_addr
    - proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for
    - proxy_set_header X-Forwarded-Proto $scheme
    - resolver 8.8.8.8 8.8.4.4 valid=300s
    - resolver_timeout 5s
    - client_max_body_size 32M

